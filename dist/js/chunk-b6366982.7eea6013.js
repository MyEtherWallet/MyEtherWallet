(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b6366982"],{"0546":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return U}));var a,s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"swap-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.bityExitToFiat,expression:"!bityExitToFiat"}]},[r("swap-confirmation-modal",{ref:"swapConfirmation",attrs:{"selected-provider":e.selectedProvider,"swap-details":e.swapDetails,"current-address":e.currentAddress},on:{swapStarted:e.resetSwapState}}),r("swap-send-to-modal",{ref:"swapSendTo",attrs:{"selected-provider":e.selectedProvider,"swap-details":e.swapDetails,"current-address":e.currentAddress,swap:e.swap},on:{swapStarted:e.resetSwapState}}),r("signature-modal",{ref:"signatureModal",attrs:{signature:e.stringToSign,"send-signed":e.sendSignedCallback}}),r("div",{staticClass:"title-block"},[r("interface-container-title",{attrs:{title:e.$t("common.swap")}})],1),e.showWarning?r("div",{staticClass:"swap-warning-message"},[e._v(" "+e._s(e.$t("swap.warning.currency-warning",{currency:e.toCurrency}))+" ")]):e._e(),r("div",{staticClass:"form-content-container"},[r("div",{staticClass:"send-form"},[r("div",{staticClass:"form-block amount-to-address"},[r("div",{staticClass:"amount"},[r("div",{staticClass:"title title-and-copy"},[r("h4",[e._v(e._s(e.$t("swap.from")))]),e.tokenBalances[e.fromCurrency]>0?r("p",{staticClass:"all-button prevent-user-select",on:{click:e.swapAll}},[e._v(" "+e._s(e.$t("common.balance.total"))+" ")]):e._e()]),r("swap-currency-picker",{attrs:{currencies:e.fromArray,"override-currency":e.overrideFrom,"from-source":!0,"swap-token-address":e.getTokenAddress,page:"SwapContainerFrom"},on:{selectedCurrency:e.setFromCurrency}}),r("div",{staticClass:"the-form amount-number"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.fromValue,expression:"fromValue"}],attrs:{placeholder:e.$t("swap.deposit-amount"),type:"number",name:"",value:"",step:"any"},domProps:{value:e.fromValue},on:{input:[function(t){t.target.composing||(e.fromValue=t.target.value)},function(t){return e.amountChanged("from")}]}})]),r("div",{staticClass:"error-message-container"},[e.fromBelowMinAllowed?r("p",[e._v(e._s(e.fromBelowMinAllowed))]):e._e(),e.hasEnough||e.fromBelowMinAllowed?e._e():r("p",[e._v(" "+e._s(e.$t("swap.warning.not-enough-funds"))+" ")]),e.gasNotice&&"ETH"===e.fromCurrency?r("p",[e._v(" "+e._s(e.$t("swap.warning.not-enough-eth-gas"))+" ")]):e._e(),e.gasNotice&&"ETH"!==e.fromCurrency?r("p",[e._v(" "+e._s(e.$t("swap.warning.not-enough-tx-fee"))+" ")]):e._e(),e.fromAboveMaxAllowed?r("p",[e._v(e._s(e.fromAboveMaxAllowed))]):e._e()])],1),r("div",{staticClass:"exchange-icon",on:{click:e.flipCurrencies}},[r("img",{attrs:{src:e.images.swap,alt:""}})]),r("div",{staticClass:"amount"},[r("div",{staticClass:"title"},[r("h4",[e._v(e._s(e.$t("swap.to")))])]),r("swap-currency-picker",{attrs:{currencies:e.toArray,"override-currency":e.overrideTo,"from-source":!1,"swap-token-address":e.getTokenAddress,page:"SwapContainerTo"},on:{selectedCurrency:e.setToCurrency}}),r("div",{staticClass:"the-form amount-number"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.toValue,expression:"toValue"}],attrs:{placeholder:e.$t("swap.recieve-amount"),type:"number",name:"",value:"",step:"any"},domProps:{value:e.toValue},on:{input:[function(t){t.target.composing||(e.toValue=t.target.value)},function(t){return e.amountChanged("to")}]}})]),r("div",{staticClass:"error-message-container"},[e.toBelowMinAllowed?r("p",[e._v(e._s(e.toBelowMinAllowed))]):e._e(),e.toAboveMaxAllowed?r("p",[e._v(e._s(e.toAboveMaxAllowed))]):e._e()])],1)])]),e.isExitToFiat||e.isBityCryptoToCrypto()?e._e():r("div",{staticClass:"send-form"},[r("div",{staticClass:"the-form gas-amount"},[r("swap-address-selector",{attrs:{currency:e.toCurrency,"current-address":e.currentAddress,copybutton:!0,title:e.$t("sendTx.to-addr"),"clear-address":e.overrideAddress},on:{toAddress:e.setToAddress,validAddress:function(t){e.validAddress=t},unableToValidate:function(t){e.unableToValidate=t}}})],1)]),!e.isExitToFiat&&e.isBityCryptoToCrypto(e.fromCurrency)?r("div",{staticClass:"send-form"},[r("div",{staticClass:"the-form gas-amount"},[e._v(" Amount will be sent to your current wallet address. ")])]):e._e(),e.isExitToFiat&&e.fromCurrency!==e.baseCurrency?r("div",{staticClass:"send-form"},[r("div",{staticClass:"the-form gas-amount"},[r("swap-address-selector",{attrs:{currency:e.fromCurrency,"current-address":e.currentAddress,copybutton:!0,"clear-address":e.overrideAddress,title:e.$t("sendTx.from-addr")},on:{toAddress:e.setExitFromAddress,validAddress:function(t){e.validExitAddress=t},unableToValidate:function(t){e.unableToValidateExit=t}}})],1)]):e._e(),e.showRefundAddress?r("div",{staticClass:"send-form"},[r("div",{staticClass:"the-form gas-amount"},[r("swap-address-selector",{attrs:{currency:e.fromCurrency,"current-address":e.currentAddress,copybutton:!0,"clear-address":e.overrideAddress,title:e.$t("swap.refund",{currency:e.fromCurrency})},on:{toAddress:e.setRefundAddress,validAddress:function(t){e.validRefundAddress=t},unableToValidate:function(t){e.unableToValidateRefund=t}}})],1)]):e._e(),r("div",{staticClass:"send-form"},[r("div",{staticClass:"title-container"},[r("div",{staticClass:"title title-and-copy"},[r("h4",[e._v(e._s(e.$tc("swap.providers.string",2)))])])]),r("providers-radio-selector",{attrs:{"loading-provider-error":e.loadingError,"loading-provider-rates":!e.haveProviderRates,"provider-data":e.providerList,"from-value":+e.fromValue,"to-value":+e.toValue,"no-providers-pair":e.noProvidersPair,"loading-data":e.loadingData,"providers-found":e.providersFound,"provider-selected":e.selectedProvider,"switch-currency-order":e.switchCurrencyOrder,"all-supported-providers":e.supportedProviders,"provider-selected-name":e.providerSelectedName},on:{selectedProvider:e.setSelectedProvider}})],1),r("div",{staticClass:"fee-notice"},[e.gasNotice&&"ETH"===e.fromCurrency?r("span",[e._v(" "+e._s(e.$t("swap.warning.not-enough-eth-gas")))]):e._e(),e.gasNotice&&"ETH"!==e.fromCurrency?r("span",[e._v(" "+e._s(e.$t("swap.warning.not-enough-tx-fee")))]):e._e()]),r("div",{staticClass:"submit-button-container"},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.finalizingSwap,expression:"finalizingSwap"}],staticClass:"disabled submit-button large-round-button-green-filled clickable"},[r("i",{staticClass:"fa fa-spinner fa-spin"}),e._v(" "+e._s(e.$t("swap.button-loading"))+" ")]),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.finalizingSwap,expression:"!finalizingSwap"}],class:[e.validSwap?"":"disabled","submit-button large-round-button-green-filled clickable"],on:{click:e.swapConfirmationModalOpen}},[e.recalculating?r("span",[e._v(e._s(e.$t("swap.recalculating")))]):r("span",[e._v(e._s(e.$t("common.continue")))]),r("i",{staticClass:"fa fa-long-arrow-right",attrs:{"aria-hidden":"true"}})]),r("div",{staticClass:"clear-all-btn",on:{click:function(t){return e.reset()}}},[e._v(" "+e._s(e.$t("common.clear-all"))+" ")])])])],1),e.bityExitToFiat?r("swap-exit-to-fiat",{attrs:{"swap-details":e.swapDetails,"exit-from-address":e.exitSourceAddress,"exit-to-fiat-callback":e.exitToFiatCallback},on:{backButtonClick:e.exitToFiatAbort}}):e._e()],1)},i=[],n=(r("99af"),r("a623"),r("7db0"),r("caad"),r("d81d"),r("13d5"),r("b0c0"),r("b680"),r("d3b7"),r("25f0"),r("2532"),r("3ca3"),r("ddb0"),r("96cf"),r("1da1")),o=r("ade3"),d=r("2909"),c=r("5530"),u=r("901e"),l=r.n(u),m=r("34eb"),p=r.n(m),f=r("2f62"),h=r("ce96"),v=r("16c6"),w=r("12fd"),y=r("55c1"),b=r("37d0"),g=r.n(b),C=r("6822"),A=r.n(C),x=r("458a"),k=r.n(x),V=r("b8b3"),T=r.n(V),E=r("ba84"),F=r("3d8e"),_=r("5766"),R=r("aeba"),P=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-modal",{ref:"signatureModal",staticClass:"bootstrap-modal",attrs:{title:e.$t("swap.address-verification"),"hide-footer":"",centered:"",static:"",lazy:""}},[r("div",{staticClass:"modal-contents"},[r("div",[r("div",{staticClass:"copy-container"},[r("h4",[e._v(e._s(e.$t("swap.message-to-sign")))])]),e._v(" "+e._s(e.signature)+" "),r("div",{staticClass:"button-container"},[r("button",{staticClass:"submit-button large-round-button-green-filled clickable",on:{click:function(t){return e.sign()}}},[e._v(" "+e._s(e.$t("swap.proceed-to-sign"))+" ")])])])])])],1)},S=[],$={props:{signature:{type:String,default:""},sendSigned:{type:Function,default:function(){}}},computed:Object(c["a"])({},Object(f["c"])("main",["account","web3"])),methods:{sign:function(){var e=this;try{this.web3.eth.sign(this.signature,this.account.address).then((function(t){e.sendSigned(t),e.$refs.signatureModal.hide()})).catch((function(e){h["e"].responseHandler(e,h["e"].ERROR)}))}catch(t){h["e"].responseHandler(t,h["e"].ERROR)}}}},N=$,O=(r("e48f"),r("2877")),D=Object(O["a"])(N,P,S,!1,null,"dd6cfd3c",null),B=D.exports,j=r("b643"),M=r("70c1"),z=r.n(M),I=p()("v5:swapContainer"),H={components:{"interface-container-title":y["a"],"swap-currency-picker":E["a"],"swap-address-selector":w["a"],"providers-radio-selector":v["a"],"swap-confirmation-modal":F["a"],"swap-exit-to-fiat":_["a"],"swap-send-to-modal":R["a"],"signature-modal":B},props:{tokensWithBalance:{type:Array,default:function(){return[]}}},data:function(){return{MARKET_IMPACT_CUTOFF:10,baseCurrency:j["a"],stringToSign:"",signedString:"",providerSelectedName:"",toAddress:"",currentAddress:"",refundAddress:"",exitFromAddress:"",fromCurrency:"ETH",toCurrency:"ETH",displayToValue:1,displayFromValue:1,fromValue:1,toValue:1,invalidFrom:"none",lastBestRate:0,lastFeeEstimate:new l.a(0),bitySpecialCurrencies:["BTC","REP"],warningCurrencies:["VET"],selectedProvider:{},swapDetails:{},currencyDetails:{},swap:new j["e"](j["n"],{network:this.$store.state.main.network.type.name,web3:this.$store.state.main.web3,gasPrice:this.$store.state.main.gasPrice,getRateForUnit:!1},{tokensWithBalance:this.tokensWithBalance}),images:{kybernetowrk:A.a,bity:k.a,visaMaster:T.a,swap:g.a},toArray:[],fromArray:[],providerData:[],tokenBalances:{},providerRatesRecieved:[],noProvidersPair:{},providersFound:[],tempStatuses:[],overrideFrom:{},overrideTo:{},providerNames:j["m"],supportedProviders:j["p"],fiatCurrenciesArray:j["h"].map((function(e){return e.symbol})),finalizingSwap:!1,validAddress:!0,validRefundAddress:!0,validExitAddress:!0,ratesRetrived:!1,issueRecievingRates:!1,loadingData:!0,haveProviderRates:!1,loadingError:!1,switchCurrencyOrder:!1,bityExitToFiat:!1,gasNotice:!1,moreEthNeeded:!1,recalculating:!0,showWarning:!1,exitToFiatCallback:function(){},sendSignedCallback:function(){},debounceUpdateEstimate:{},debounceDoThing:{},unableToValidate:!1,unableToValidateExit:!1,unableToValidateRefund:!1,overrideAddress:!1}},computed:Object(c["a"])(Object(c["a"])({},Object(f["c"])("main",["account","ens","gasPrice","web3","network","online"])),{},{bestRate:function(){var e=this;try{return this.providerData.length>0?this.selectedProvider.provider?this.providerList.find((function(t){return t.provider===e.selectedProvider.provider})).rate:Object(j["g"])(Object(d["a"])(this.providerList),this.fromValue):this.lastBestRate}catch(t){I(t)}return null},fromBelowMinAllowed:function(){return new l.a(j["d"]).gt(new l.a(this.fromValue))?"".concat(this.$t("swap.value-below-min")," ").concat(j["d"]):!!new l.a(this.selectedProvider.minValue).gt(new l.a(this.fromValue))&&this.$t("swap.value-below-min",{value:this.selectedProvider.maxValue,currency:this.fromCurrency})},fromAboveMaxAllowed:function(){return this.selectedProvider.provider===this.providerNames.bity?!!this.checkBityMax&&this.$t("swap.value-above-max",{value:this.selectedProvider.maxValue,currency:this.fromCurrency}):!(!new l.a(this.fromValue).gt(new l.a(this.selectedProvider.maxValue))||!new l.a(this.selectedProvider.maxValue).gt(new l.a(0)))&&this.$t("swap.value-above-max",{value:this.selectedProvider.maxValue,currency:this.fromCurrency})},toBelowMinAllowed:function(){return!!new l.a(0).gte(new l.a(this.toValue))&&this.$t("swap.below-min-swap")},toAboveMaxAllowed:function(){return!!this.checkBityMax&&this.$t("swap.above-max-swap")},providerList:function(){return this.providerData.length>0?Object(j["f"])(Object(d["a"])(this.providerData),this.fromValue):[]},isExitToFiat:function(){return this.fiatCurrenciesArray.includes(this.toCurrency)},validSwap:function(){if(this.recalculating)return!1;if(this.gasNotice)return!1;var e=!this.isExitToFiat||this.fromCurrency===this.baseCurrency||""!==this.exitFromAddress;return this.hasEnough&&(""!==this.toAddress||e)&&this.allAddressesValid&&this.selectedProvider.minValue<=+this.fromValue&&(+this.fromValue<=this.selectedProvider.maxValue||0===this.selectedProvider.maxValue)},checkBityMax:function(){return!!this.swap.isProvider(this.providerNames.bity)&&(!this.swap.getProvider(this.providerNames.bity).maxCheck(this.fromCurrency,this.fromValue,this.toCurrency,this.toValue)&&this.selectedProvider.provider===this.providerNames.bity)},showRefundAddress:function(){return!j["e"].isToken(this.fromCurrency)&&this.selectedProvider.provider===this.providerNames.changelly},allAddressesValid:function(){var e=""!==this.toAddress&&this.validAddress;if(this.isExitToFiat)return this.fromCurrency===this.baseCurrency||""!==this.exitFromAddress&&this.validExitAddress;if(this.showRefundAddress){if(this.fromCurrency===this.baseCurrency||j["e"].isToken(this.fromCurrency)){var t=""===this.refundAddress&&this.validRefundAddress;return e&&t}return j["e"].checkAddress(this.refundAddress,this.fromCurrency)}return e},hasEnough:function(){return this.swap.hasEnough(this.fromCurrency,this.fromValue,this.baseCurrency,this.tokenBalances,this.account.balance)},exitSourceAddress:function(){return this.isExitToFiat&&this.fromCurrency===this.baseCurrency?this.currentAddress:this.exitFromAddress}}),watch:(a={},Object(o["a"])(a,"gasPrice",(function(e){this.selectedProvider||(this.selectedProvider={}),this.swap.updateGasPrice(this.selectedProvider.provider,e)})),Object(o["a"])(a,"this.network.type.name",(function(){this.swap.updateNetwork(this.network.type.name,this.web3)})),Object(o["a"])(a,"swap.updateProviderRates",(function(){try{var e=this.swap.buildInitialCurrencyArrays(),t=e.toArray,r=e.fromArray;this.toArray=t,this.fromArray=r}catch(n){var a=this.swap.initialCurrencyLists,s=a.toArray,i=a.fromArray;this.toArray=s,this.fromArray=i}})),Object(o["a"])(a,"swap.haveProviderRates",(function(){this.haveProviderRates=this.swap.ratesRetrieved;var e=this.swap.buildInitialCurrencyArrays(),t=e.toArray,r=e.fromArray;this.toArray=t,this.fromArray=r,this.lastBestRate=Object(j["g"])(Object(d["a"])(this.providerList),this.fromValue),this.updateRateEstimate(this.fromCurrency,this.toCurrency,this.fromValue,"from")})),Object(o["a"])(a,"network",(function(e){this.providerData=[],this.haveProviderRates=!1,this.loadingData=!1,this.swap=new j["e"](j["n"],{network:e.type.name,web3:this.web3,gasPrice:this.gasPrice,getRateForUnit:!1},{tokensWithBalance:this.tokensWithBalance})})),a),mounted:function(){var e=this.swap.initialCurrencyLists,t=e.toArray,r=e.fromArray;this.toArray=t,this.fromArray=r,this.currentAddress=this.account.address,this.debounceUpdateEstimate=this.web3.utils._.debounce(this.updateEstimate,300),this.debounceReviseRateEstimate=this.web3.utils._.debounce(this.updateRateEstimate,2e3)},methods:{getTokenAddress:function(e){return this.swap.getTokenAddress(e,!0)},reset:function(){this.lastFeeEstimate=new l.a(0),this.gasNotice=!1,this.fromCurrency="BTC",this.toCurrency="ETH",this.overrideFrom={name:"Bitcoin",symbol:"BTC"},this.overrideTo={name:"Ether",symbol:"ETH"},this.fromValue=1,this.overrideAddress=!this.overrideAddress,this.providerSelectedName="",this.toAddress="",this.refundAddress="",this.exitFromAddress="",this.updateRateEstimate(this.fromCurrency,this.toCurrency,this.fromValue,"from"),this.finalizingSwap=!1,this.validAddress=!0,this.issueRecievingRates=!1,this.loadingError=!1,this.switchCurrencyOrder=!1,this.bityExitToFiat=!1,this.sendSignedCallback=function(){}},isBityCryptoToCrypto:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BTC",t=this.bitySpecialCurrencies.includes(e)&&this.selectedProvider.provider===this.providerNames.bity;return t&&(this.setToAddress(this.currentAddress),this.validAddress=!0,this.unableToValidate=!1),t},flipCurrencies:function(){this.providerSelectedName="",this.switchCurrencyOrder=!0;var e=this.toValue;this.fromCurrency=this.currencyDetails.to.symbol,this.toCurrency=this.currencyDetails.from.symbol,this.overrideFrom=this.currencyDetails.to,this.overrideTo=this.currencyDetails.from,this.updateRateEstimate(this.fromCurrency,this.toCurrency,e,"from"),this.switchCurrencyOrder=!1},setSelectedProvider:function(e){this.selectedProvider=this.providerList.find((function(t){return t.provider===e})),this.selectedProvider||(this.selectedProvider={}),this.providerSelectedName=this.selectedProvider.provider,this.updateEstimate("from")},setToAddress:function(e){this.toAddress=e},setRefundAddress:function(e){this.refundAddress=e},setExitFromAddress:function(e){this.exitFromAddress=e},swapAll:function(){this.fromValue=this.swap.convertToTokenBase(this.fromCurrency,this.tokenBalances[this.fromCurrency]),this.amountChanged("from")},setFromCurrency:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"from";this.providerSelectedName="",this.currencyDetails.from=e,this.fromCurrency=e.symbol,this.getBalance(this.fromCurrency),this.toArray=this.swap.setToCurrencyBuilder(e),this.updateRateEstimate(this.fromCurrency,this.toCurrency,this.fromValue,t)},setToCurrency:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"to";this.providerSelectedName="",this.currencyDetails.to=e,this.toCurrency=e.symbol,this.fromArray=this.swap.setFromCurrencyBuilder(e),this.updateRateEstimate(this.fromCurrency,this.toCurrency,this.fromValue,t)},getBalance:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!j["e"].isToken(e)||e===t.baseCurrency){r.next=5;break}return r.next=3,new t.web3.eth.Contract(j["b"],t.swap.getTokenAddress(e)).methods.balanceOf(t.currentAddress).call();case 3:a=r.sent,t.$set(t.tokenBalances,e,a);case 5:case"end":return r.stop()}}),r)})))()},amountChanged:function(e){if(Object(j["j"])(this.fromValue)&&"from"===e||Object(j["j"])(this.toValue)&&"to"===e)if(this.recalculating=!0,this.swap.getProvider(this.providerNames.simplex).currencies.fiat[this.fromCurrency]){this.debounceUpdateEstimate(this.providerNames.simplex+e);var t=this.fromCurrency,r=this.toCurrency,a=this.fromValue;this.debounceReviseRateEstimate(t,r,a,e)}else{this.debounceUpdateEstimate(e);var s=this.fromCurrency,i=this.toCurrency,n=this.fromValue;this.debounceReviseRateEstimate(s,i,n,e)}},updateEstimate:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s,i,n,o,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.simplexUpdate){r.next=3;break}return t.simplexUpdate=!1,r.abrupt("return");case 3:r.t0=e,r.next="to"===r.t0?6:"from"===r.t0?10:r.t0==="".concat(t.providerNames.simplex,"to")?14:r.t0==="".concat(t.providerNames.simplex,"from")?30:46;break;case 6:return t.fromValue=t.swap.calculateFromValue(t.toValue,t.bestRate,t.fromCurrency),t.intermediateGasCheck(),t.gasCheck(),r.abrupt("break",53);case 10:return t.toValue=t.swap.calculateToValue(t.fromValue,t.bestRate,t.toCurrency),t.intermediateGasCheck(),t.gasCheck(),r.abrupt("break",53);case 14:if(t.simplexUpdate=!0,i=t.swap.getProvider(t.providerNames.simplex),!i.canQuote(t.fromValue,t.toValue,t.fromCurrency)){r.next=24;break}return r.next=19,i.updateDigital(t.fromCurrency,t.toCurrency,t.toValue);case 19:n=r.sent,t.fromValue=n.fromValue,t.toValue=n.toValue,r.next=29;break;case 24:return r.next=26,i.updateFiat(t.fromCurrency,t.toCurrency,-1);case 26:n=r.sent,o=new l.a(n.toValue).div(n.fromValue).toString(10),t.fromValue=t.swap.calculateFromValue(t.toValue,o,t.fromCurrency);case 29:return r.abrupt("break",53);case 30:if(t.simplexUpdate=!0,i=t.swap.getProvider(t.providerNames.simplex),!i.canQuote(t.fromValue,t.toValue,t.fromCurrency)){r.next=40;break}return r.next=35,i.updateFiat(t.fromCurrency,t.toCurrency,t.fromValue);case 35:n=r.sent,t.fromValue=n.fromValue,t.toValue=n.toValue,r.next=45;break;case 40:return r.next=42,i.updateFiat(t.fromCurrency,t.toCurrency,-1);case 42:n=r.sent,d=new l.a(n.toValue).div(n.fromValue).toString(10),t.toValue=t.swap.calculateToValue(t.fromValue,d);case 45:return r.abrupt("break",53);case 46:return s=t.swap.calculateToValue(t.fromValue,t.bestRate),a=t.swap.calculateFromValue(t.toValue,t.bestRate),t.toValue=s,t.fromValue=a,t.intermediateGasCheck(),t.gasCheck(),r.abrupt("break",53);case 53:case"end":return r.stop()}}),r)})))()},updateRateEstimate:function(e,t,r,a){var s=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var n,o,c,u,m;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!s.haveProviderRates){i.next=20;break}return s.showWarning=s.warningCurrencies.includes(t),s.loadingData=!0,s.recalculating=!0,s.noProvidersPair={fromCurrency:e,toCurrency:t},s.selectedProvider={},s.providerData=[],i.next=9,s.swap.updateRateEstimate(e,t,r,s.toValue);case 9:return n=i.sent,o=n.providersFound,c=n.callsToMake,s.providersFound=o,i.next=15,Promise.all(c.map((function(a){return a(e,t,r,s.toValue)})));case 15:u=i.sent,s.loadingData=!1,s.recalculating=!1,m=u.reduce((function(e,t){return Array.isArray(t)?e=[].concat(Object(d["a"])(e),Object(d["a"])(t)):e.push(t),e}),[]),m.every((function(e){return e.fromCurrency===s.fromCurrency&&e.toCurrency===s.toCurrency}))&&(s.providerData=Object(j["f"])(m.map((function(r){if(+r.rate>0)return{provider:r.provider,fromCurrency:e,fromValue:s.fromValue,toCurrency:t,rate:+r.rate,minValue:r.minValue||0,maxValue:r.maxValue||0,computeConversion:function(e){var a=s.fiatCurrenciesArray.includes(t)?2:6;return new l.a(e).times(r.rate).toFixed(a).toString(10)},additional:r.additional||{}};r.provider===s.providerNames.changelly?h["e"].responseHandler(s.$t("swap.notice.retrieve-changelly-rate-failed",{fromCurrency:e,toCurrency:t}),3):r.provider===s.providerNames.bity?h["e"].responseHandler(s.$t("swap.notice.retrieve-bity-rate-failed",{fromCurrency:e,toCurrency:t}),3):r.provider===s.providerNames.kyber?h["e"].responseHandler(s.$t("swap.notice.retrieve-kyber-rate-failed",{fromCurrency:e,toCurrency:t}),3):r.provider===s.providerNames.simplex&&h["e"].responseHandler(s.$t("swap.notice.retrieve-simplex-rate-failed",{fromCurrency:e,toCurrency:t}),3)})),r),s.updateEstimate(a));case 20:case"end":return i.stop()}}),i)})))()},checkForEnoughGas:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,s,i,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=new l.a(0),t.lastFeeEstimate=new l.a(0),s=new l.a(z.a.toWei(t.gasPrice,"gwei")),!j["e"].isToken(e.fromCurrency)&&!j["e"].isToken(e.toCurrency)){r.next=24;break}if(!Array.isArray(e.dataForInitialization)){r.next=20;break}i=0;case 6:if(!(i<e.dataForInitialization.length)){r.next=20;break}if(!e.dataForInitialization[i].gas){r.next=12;break}t.lastFeeEstimate=t.lastFeeEstimate.plus(s.times(e.dataForInitialization[i].gas)),a=a.plus(new l.a(e.dataForInitialization[i].value)),r.next=17;break;case 12:return r.next=14,t.web3.eth.estimateGas(e.dataForInitialization[i]);case 14:n=r.sent,t.lastFeeEstimate=t.lastFeeEstimate.plus(s.times(n)),a=a.plus(e.dataForInitialization[i].value);case 17:i++,r.next=6;break;case 20:return o=new l.a(t.account.balance).minus(a.plus(t.lastFeeEstimate)).gt(0),t.moreEthNeeded=new l.a(t.account.balance).lt(t.lastFeeEstimate),a.gt(0)||(t.lastFeeEstimate=new l.a(0)),r.abrupt("return",o);case 24:case"end":return r.stop()}}),r)})))()},intermediateGasCheck:function(){"ETH"===this.fromCurrency&&this.lastFeeEstimate.gt(0)?this.gasNotice=new l.a(this.account.balance).minus(new l.a(new l.a(z.a.toWei(this.fromValue,"ether"))).plus(this.lastFeeEstimate)).lte(0):this.gasNotice=!1},gasCheck:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,j["e"].isToken(e.fromCurrency)&&j["e"].isToken(e.toCurrency)){t.next=4;break}return e.gasNotice=!1,t.abrupt("return");case 4:if(e.selectedProvider.provider){t.next=7;break}return e.gasNotice=!1,t.abrupt("return");case 7:return r=e.providerList.find((function(t){return t.provider===e.selectedProvider.provider})),a={providerDetails:r,fromValue:e.fromValue,toValue:e.toValue,toAddress:e.toAddress||e.currentAddress,fromAddress:e.currentAddress,refundAddress:j["e"].isToken(r.fromCurrency)?e.currentAddress:e.refundAddress,exitFromAddress:e.isExitToFiat&&e.fromCurrency===e.baseCurrency?e.currentAddress:e.exitFromAddress},t.next=11,e.swap.startSwap(a);case 11:if(a=t.sent,!a.marketImpact){t.next=14;break}throw Error("marketImpactAbort");case 14:return t.next=16,e.checkForEnoughGas(a);case 16:if(s=t.sent,s){t.next=19;break}throw Error("notEnoughWithGas");case 19:e.gasNotice=!1,t.next=34;break;case 22:if(t.prev=22,t.t0=t["catch"](0),"marketImpactAbort"!==t.t0.message){t.next=29;break}return e.finalizingSwap=!1,t.abrupt("return");case 29:if("notEnoughWithGas"!==t.t0.message){t.next=33;break}return e.finalizingSwap=!1,e.gasNotice=!0,t.abrupt("return");case 33:e.gasNotice=!1;case 34:case"end":return t.stop()}}),t,null,[[0,22]])})))()},swapConfirmationModalOpen:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.validSwap){t.next=17;break}return e.finalizingSwap=!0,r=e.providerList.find((function(t){return t.provider===e.selectedProvider.provider})),a={providerDetails:r,fromValue:e.fromValue,toValue:e.toValue,toAddress:e.toAddress||e.currentAddress,fromAddress:e.currentAddress,refundAddress:j["e"].isToken(r.fromCurrency)?e.currentAddress:e.refundAddress,exitFromAddress:e.isExitToFiat&&e.fromCurrency===e.baseCurrency?e.currentAddress:e.exitFromAddress},t.next=7,e.swap.startSwap(a);case 7:if(e.swapDetails=t.sent,!e.swapDetails.marketImpact){t.next=10;break}throw Error("marketImpactAbort");case 10:return t.next=12,e.checkForEnoughGas(e.swapDetails);case 12:if(s=t.sent,s){t.next=15;break}throw Error("notEnoughWithGas");case 15:e.finalizingSwap=!1,e.swapDetails.isExitToFiat?(e.bityExitToFiat=!0,e.exitToFiatCallback=function(t){e.bityExitToFiat=!1,e.swapDetails=t,e.openConfirmModal(e.swapDetails)}):e.isBityCryptoToCrypto()||e.isBityCryptoToCrypto("REP")?(e.stringToSign=e.swapDetails.dataForInitialization.messageToSign.body,e.$refs.signatureModal.$refs.signatureModal.show(),e.sendSignedCallback=function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.swap.extraActions(e.providerNames.bity,"sendSigned",{signature:r,signature_submission_url:e.swapDetails.dataForInitialization.messageToSign.signature_submission_url,statusId:e.swapDetails.dataForInitialization.id,token:e.swapDetails.dataForInitialization.token});case 2:a=t.sent,e.swapDetails.providerAddress=a.payment_details.crypto_address,e.openConfirmModal(e.swapDetails);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):e.openConfirmModal(e.swapDetails);case 17:t.next=43;break;case 19:if(t.prev=19,t.t0=t["catch"](0),"marketImpactAbort"!==t.t0.message){t.next=27;break}return e.finalizingSwap=!1,h["e"].responseHandler("liquidity-too-low",1,!0),t.abrupt("return");case 27:if("notEnoughWithGas"!==t.t0.message){t.next=34;break}return e.finalizingSwap=!1,e.gasNotice=!0,h["e"].responseHandler("error-generating-swap",1,!0),t.abrupt("return");case 34:if("abort"!==t.t0.message){t.next=38;break}return e.finalizingSwap=!1,h["e"].responseHandler("error-generating-swap",1,!0),t.abrupt("return");case 38:e.$refs.swapConfirmation.$refs.swapconfirmation.hide(),e.$refs.swapSendTo.$refs.swapconfirmation.hide(),e.finalizingSwap=!1,I(t.t0),h["e"].responseHandler(t.t0,!1);case 43:case"end":return t.stop()}}),t,null,[[0,19]])})))()},openConfirmModal:function(e){if(e.dataForInitialization&&e.maybeToken)this.$refs.swapConfirmation.$refs.swapconfirmation.show();else{if(!e.dataForInitialization||e.maybeToken)throw Error(this.$t("swap.notice.error-finalizing"));this.$refs.swapSendTo.$refs.swapconfirmation.show()}},exitToFiatAbort:function(){this.bityExitToFiat=!this.bityExitToFiat},resetSwapState:function(){this.reset()}}},W=H,G=(r("4e63"),Object(O["a"])(W,s,i,!1,null,"047fff10",null)),U=G.exports},"4e63":function(e,t,r){"use strict";var a=r("d87a"),s=r.n(a);s.a},b3ff:function(e,t,r){},d87a:function(e,t,r){},e48f:function(e,t,r){"use strict";var a=r("b3ff"),s=r.n(a);s.a}}]);
//# sourceMappingURL=../sourcemaps/js/chunk-b6366982.7eea6013.js.map