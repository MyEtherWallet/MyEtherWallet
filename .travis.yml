language: node_js
sudo: required
dist: trusty
node_js: '7'
env: CXX=g++-4.8
addons:
  apt:
    sources: ubuntu-toolchain-r-test
    packages: g++-4.8
branches:
  except:
  - gh-pages
stages:
- remove .gitignore
- lint code
- build application
- name: create release
  if: branch = master and type != pull_request
- name: deploy to production
  if: branch = master and type != pull_request
jobs:
  fast_finish: true
  include:
  - stage: remove .gitignore
    script: rm .gitignore
  - stage: lint code
    script: npm run lint
  - stage: build application
    script: npm run build
  - stage: create release
    script: bash ./release.sh
    before_deploy:
      - git config --local user.name "gamalielhere"
      - git config --local user.email "gamalielgad1234@gmail.com"
      - ls -a | sort
      - |
        PACKAGE_VERSION=$(cat package.json | grep version | head -1 | awk -F: '{ print $2 }' | sed 's/[",]//g' | tr -d '[[:space:]]');
      - git tag "v$PACKAGE_VERSION"
    deploy:
      provider: releases
      api_key:
        secure: Bzwd+lWJamc4NyDUU+DO9dj5vVMgMj/bwJtmdJKz3paUSnjdY8kg6UdLKf01TLCEb6QN1xpxYOarKMyojSZHV7Q44NyuXNahkigFT78aKw6UUInliUUk88MivfPupoQrqAa+261plyQFc3WhuDRaQahTfxlW1jaaUcywbCg+LaGWRFkuCBQ9fsgsjR89hhFDKk1FL/ws9IKBCBi9VQOg52XPXzeUAXjkDVjWCL0wnVzmd66oa1S+DT/Z58rJXGumt0ZEEcG8Lq3BeFOS0d7J3IlIdzMLQfI4ZW92QwayQEFomwE9G+aq4UvTxJkQB4BRkYfY19NYQs12wSMfeAEeSuyXLLmmQcoj8HzSg58qR3PPt6dOvC3CRew4JwOghvKjO7L1SEv1/uq2gI2Aw/J2tI4FRcbJU+ngEa8RW37Ay8u1EO8xyka+rY4fYSIOIqAxfSYzJPabGoLBhNKWVV9QCj3TwVJeK9xXJ359AofWq5owAtvqNmMbRje4mETmQ/LuIDmrwjfyi7Gs6Q56jHqCv5OAQLFDbUgr/2DxPeeuPb113q1JCvcpeQDH1SUovJvG4V3cC2OFmHazW7SLGaU1jf9lGHQOTnIffn5Xrptqbw4oeakvOUyWFKbSodCdM2hao5pYyHJUyx2J+1asqW49MAO9nnoJKC43S0uidku+uSc=
      file_blog: true
      file: deploy/*
      skip_cleanup: true
      on:
        repo: gamalielhere/MyEtherWallet
        branch: master
  - stage: deploy to production
    api_key:
      secure: Bzwd+lWJamc4NyDUU+DO9dj5vVMgMj/bwJtmdJKz3paUSnjdY8kg6UdLKf01TLCEb6QN1xpxYOarKMyojSZHV7Q44NyuXNahkigFT78aKw6UUInliUUk88MivfPupoQrqAa+261plyQFc3WhuDRaQahTfxlW1jaaUcywbCg+LaGWRFkuCBQ9fsgsjR89hhFDKk1FL/ws9IKBCBi9VQOg52XPXzeUAXjkDVjWCL0wnVzmd66oa1S+DT/Z58rJXGumt0ZEEcG8Lq3BeFOS0d7J3IlIdzMLQfI4ZW92QwayQEFomwE9G+aq4UvTxJkQB4BRkYfY19NYQs12wSMfeAEeSuyXLLmmQcoj8HzSg58qR3PPt6dOvC3CRew4JwOghvKjO7L1SEv1/uq2gI2Aw/J2tI4FRcbJU+ngEa8RW37Ay8u1EO8xyka+rY4fYSIOIqAxfSYzJPabGoLBhNKWVV9QCj3TwVJeK9xXJ359AofWq5owAtvqNmMbRje4mETmQ/LuIDmrwjfyi7Gs6Q56jHqCv5OAQLFDbUgr/2DxPeeuPb113q1JCvcpeQDH1SUovJvG4V3cC2OFmHazW7SLGaU1jf9lGHQOTnIffn5Xrptqbw4oeakvOUyWFKbSodCdM2hao5pYyHJUyx2J+1asqW49MAO9nnoJKC43S0uidku+uSc=
    script: bash ./deploy.sh
